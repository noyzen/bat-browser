/* --- Tab Bar --- */
#tab-bar-wrapper {
    flex: 1 1 auto; /* Default to growing and shrinking */
    min-width: 50px;
    transition: flex 200ms ease-in-out, min-width 200ms ease-in-out, opacity 200ms ease-in-out;
    overflow: hidden;
    background-color: var(--bg-tab-bar);
}
#tab-bar { display: flex; align-items: center; height: 100%; width: 100%; -webkit-app-region: no-drag; }
#tabs-container-wrapper {
    flex-grow: 1;
    flex-shrink: 1;
    min-width: 0;
    overflow-x: auto;
    overflow-y: hidden;
    height: 100%;
    -ms-overflow-style: none;
    scrollbar-width: none;
}
#tabs-container-wrapper::-webkit-scrollbar {
    display: none;
}

#tabs-container { display: flex; height: 100%; width: max-content; }

#tab-scroll-left, #tab-scroll-right {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    border: none;
    background: transparent;
    color: var(--fg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 0;
    margin: 0 4px;
    transition: opacity 150ms ease-in-out;
    padding: 0;
    font-size: 12px;
}
#tab-scroll-left:not(:disabled):hover, #tab-scroll-right:not(:disabled):hover { background: var(--bg-hover); color: var(--fg-primary); }
#tab-scroll-left.hidden, #tab-scroll-right.hidden { display: none; }
#tab-scroll-left:disabled, #tab-scroll-right:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* --- Tab & Group Items --- */
.tab-item, .tab-group, .all-tabs-list-item, .all-tabs-group-header { 
    flex-shrink: 0; 
    position: relative; 
    transition: opacity 150ms ease-in-out, transform 150ms ease-in-out; 
}
.tab-item.dragging, .tab-group.dragging, .all-tabs-list-item.dragging, .all-tabs-group-header.dragging { 
    opacity: 0.4;
}

.placeholder {
    flex-shrink: 0;
    background-color: var(--accent-color);
    box-shadow: 0 0 10px var(--accent-color);
    border: none;
    margin: 0;
    transition: all 150ms ease;
}
#tabs-container .placeholder, .tab-group-tabs .placeholder {
    width: 3px;
    height: calc(100% - 10px);
}
#all-tabs-list-container .placeholder, .all-tabs-group-tabs .placeholder {
    height: 3px;
    width: 100%;
}

/* Base Tab Style */
.tab-item { 
    display: flex; align-items: center; height: 100%; 
    border-right: 1px solid var(--border-color); 
    cursor: pointer; gap: 6px; padding: 0 8px; 
    background-color: var(--bg-tab-bar); 
    max-width: 200px; min-width: 50px; border-radius: 0;
}
.tab-item:hover { background-color: var(--bg-hover); }

#tabs-container .tab-item.active { 
    background-color: var(--bg-primary);
    z-index: 2; 
}

.tab-favicon-wrapper {
    position: relative;
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

.tab-favicon {
    width: 100%; height: 100%;
    flex-shrink: 0;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    display: grid;
    place-items: center;
    font-size: 14px;
    color: var(--fg-secondary);
}

.tab-status-icon {
    position: absolute;
    display: grid;
    place-items: center;
    z-index: 1;
}

.tab-status-icon:empty {
    display: none;
}

/* Default state for non-loading icons (shared, hibernated) */
.tab-status-icon {
    bottom: -2px;
    right: -2px;
    width: 12px;
    height: 12px;
    background-color: var(--bg-tab-bar);
    border-radius: 50%;
}
.tab-item.active .tab-status-icon {
    background-color: var(--bg-primary);
}
.tab-status-icon i {
    font-size: 8px;
    color: var(--fg-secondary);
}
.tab-status-icon .fa-users {
    color: var(--accent-color);
}

/* State for loading spinner */
.tab-item.loading .tab-favicon { opacity: 0.4; }
.tab-item.loading .tab-status-icon {
    top: 0;
    left: 0;
    width: 16px;
    height: 16px;
    background-color: transparent;
    border-radius: 0;
    bottom: auto; /* override default */
    right: auto; /* override default */
}
.tab-item.loading .tab-status-icon i {
    font-size: 12px;
    color: var(--fg-primary);
    animation: spin 1s linear infinite;
}

.tab-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--fg-primary); flex-grow: 1; }
.tab-close-btn { border: none; background: transparent; color: var(--fg-secondary); width: 22px; height: 22px; font-size: 13px; line-height: 1; border-radius: 0; display: grid; place-items: center; cursor: pointer; flex-shrink: 0; padding: 0; z-index: 2; }
.tab-item .tab-close-btn { visibility: hidden; }
.tab-item:hover .tab-close-btn { visibility: visible; }
.tab-close-btn:hover { background-color: var(--bg-active); color: var(--fg-primary); }

.tab-item.hibernated { opacity: 0.6; transition: opacity 150ms ease; }
.tab-item.hibernated:hover { opacity: 1; }
.tab-item.hibernated .tab-title { font-style: italic; }

/* Tab Groups */
.tab-group { display: flex; align-items: flex-end; height: 100%; align-items: stretch; border-radius: 0; position: relative; overflow: hidden; }
.tab-group.drag-over, .all-tabs-group-header.drag-over, .all-tabs-group-container.drag-over { background-color: rgba(255,255,255,0.1); }
.group-header { display: flex; align-items: center; padding: 0 8px; gap: 6px; font-weight: bold; height: 100%; border-right: 1px solid var(--border-color); cursor: pointer; }
.tab-group.collapsed {
    box-sizing: border-box;
    margin-right: 4px;
}
.tab-group.collapsed .group-header {
    background-color: var(--tab-group-color);
    border: 2px solid var(--tab-group-color);
}
.tab-group.collapsed .group-title { color: #fff; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
.group-toggle-icon { font-size: 11px; color: var(--fg-secondary); transition: all 150ms ease-in-out; width: 18px; height: 18px; display: grid; place-items: center; border-radius: 0; flex-shrink: 0; }
.group-header:hover .group-toggle-icon { color: var(--fg-primary); }
.tab-group.collapsed .group-toggle-icon { color: #fff; }
.tab-group.collapsed .group-header:hover .group-toggle-icon { color: #fff; }
.tab-group-tabs { display: contents; }
.active-in-group-indicator { color: white; font-size: 7px; }
.group-tab-count-badge {
    background-color: transparent;
    color: #fff;
    font-size: 10px;
    font-weight: bold;
    padding: 0;
    border-radius: 0;
    line-height: 1;
}

.tab-group:not(.collapsed) {
    border-left: 2px solid var(--tab-group-color);
    border-right: 2px solid var(--tab-group-color);
    border-bottom: 2px solid var(--tab-group-color);
    box-sizing: border-box;
    background: var(--bg-tab-bar);
    padding: 0;
    margin-right: 4px;
}
.tab-group:not(.collapsed) .group-header { border-right: none; border-top: 2px solid var(--tab-group-color); }
.tab-group:not(.collapsed) .tab-group-tabs { display: flex; }
.tab-group:not(.collapsed) .tab-item { border-radius: 0; border-top: 2px solid var(--tab-group-color); border-bottom: none; border-left: none; }
.tab-group:not(.collapsed) .group-title { color: var(--tab-group-color); }
.tab-group:not(.collapsed) .tab-item:last-child { border-right: none; }
