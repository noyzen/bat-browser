<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; script-src 'self';" />
  <title>Bat Browser</title>
  <link rel="stylesheet" href="../../fonts/all.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app-container">
    <div id="app-chrome">
      <!-- Unified top bar containing tabs, toolbar, and window controls -->
      <div id="titlebar">
        <div id="window-handle" class="drag-region" title="Drag Window"><i class="fa-solid fa-grip-vertical"></i></div>
        <!-- Toolbar with address and navigation -->
        <div id="toolbar-wrapper">
          <div id="toolbar">
            <button id="add-tab-btn" title="New Tab" aria-label="New Tab">
              <i class="fa-solid fa-plus"></i>
            </button>
            <button id="all-tabs-btn" title="List all tabs" aria-label="List all tabs">
               <i class="fa-solid fa-chevron-down"></i>
            </button>
            <button id="downloads-btn" title="Downloads" aria-label="Downloads"><i class="fa-solid fa-download"></i></button>
            <button id="settings-btn" title="Settings" aria-label="Settings"><i class="fa-solid fa-cog"></i></button>
            <button id="back-btn" title="Back" aria-label="Back" disabled><i class="fa-solid fa-arrow-left"></i></button>
            <button id="forward-btn" title="Forward" aria-label="Forward" disabled><i class="fa-solid fa-arrow-right"></i></button>
            <button id="reload-btn" title="Reload" aria-label="Reload"><i id="reload-icon" class="fa-solid fa-rotate-right"></i></button>
            <div id="address-bar-container">
              <input type="text" id="address-bar" placeholder="Search or type a URL" />
            </div>
          </div>
        </div>

        <div id="tab-bar-wrapper" class="drag-region">
          <div id="tab-bar">
            <button id="tab-scroll-left" title="Scroll tabs left" class="hidden"><i class="fa-solid fa-chevron-left"></i></button>
            <div id="tabs-container-wrapper">
              <div id="tabs-container"></div>
            </div>
            <button id="tab-scroll-right" title="Scroll tabs right" class="hidden"><i class="fa-solid fa-chevron-right"></i></button>
          </div>
        </div>
        
        <div class="window-controls">
          <button id="min-btn" title="Minimize" aria-label="Minimize"><i class="fa-solid fa-window-minimize"></i></button>
          <button id="max-btn" title="Maximize" aria-label="Maximize"><i id="max-icon" class="fa-regular fa-window-maximize"></i></button>
          <button id="close-btn" title="Close" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
        </div>
      </div>
    </div>
    
    <div id="ai-panel-resize-handle" class="hidden"></div>
    <div id="ai-panel" class="hidden">
      <div class="ai-panel-header">
          <h3><i class="fa-solid fa-robot"></i> AI Assistant</h3>
          <button id="ai-panel-close-btn" title="Close Assistant" aria-label="Close Assistant"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div id="ai-chat-container">
        <div id="ai-welcome-screen">
          <div class="ai-welcome-icon"><i class="fa-solid fa-hand-sparkles"></i></div>
          <h2>Welcome to Bat AI</h2>
          <p>I can help you analyze the content of this webpage.</p>
        </div>
        <div id="ai-panel-messages"></div>
      </div>
      <div class="ai-panel-starters">
          <button data-prompt="Summarize this page.">Summarize Page</button>
          <button data-prompt="How good is the SEO on this page?">Analyze SEO</button>
          <button data-prompt="Suggest improvements for this page's accessibility.">Improve Accessibility</button>
      </div>
      <div class="ai-panel-input-container">
          <textarea id="ai-panel-input" placeholder="Ask about this page..." rows="1"></textarea>
          <button id="ai-panel-send-btn" aria-label="Send message"><i class="fa-solid fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <div id="find-bar" class="hidden">
    <input type="text" id="find-input" placeholder="Find in page" />
    <span id="find-matches">0/0</span>
    <button id="find-prev-btn" title="Previous match" aria-label="Previous match"><i class="fa-solid fa-chevron-up"></i></button>
    <button id="find-next-btn" title="Next match" aria-label="Next match"><i class="fa-solid fa-chevron-down"></i></button>
    <button id="find-close-btn" title="Close" aria-label="Close find bar"><i class="fa-solid fa-xmark"></i></button>
  </div>

  <div id="tab-search-overlay" class="hidden">
    <div id="tab-search-box">
      <input type="text" id="tab-search-input" placeholder="Search tabs..." />
      <ul id="tab-search-results"></ul>
    </div>
  </div>

  <div id="settings-view" class="hidden">
    <div class="all-tabs-titlebar"> <!-- Reuse class for styling -->
      <div class="all-tabs-titlebar-left">
        <button id="settings-back-to-browser-btn" title="Back to Browser">
          <i class="fa-solid fa-arrow-left"></i>
          <span>Back to Browser</span>
        </button>
        <div class="search-wrapper">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="settings-search-input" placeholder="Search settings">
        </div>
      </div>
       <div class="window-controls">
        <button id="settings-min-btn" title="Minimize" aria-label="Minimize"><i class="fa-solid fa-window-minimize"></i></button>
        <button id="settings-max-btn" title="Maximize" aria-label="Maximize"><i id="settings-max-icon" class="fa-regular fa-window-maximize"></i></button>
        <button id="settings-close-btn" title="Close" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
    <div id="settings-content-container">
      <div id="settings-layout">
        <nav id="settings-sidebar">
          <ul>
            <li class="active"><a href="#appearance"><i class="fa-solid fa-palette"></i> Appearance</a></li>
            <li><a href="#search"><i class="fa-solid fa-magnifying-glass"></i> Search</a></li>
            <li><a href="#identity"><i class="fa-solid fa-user-secret"></i> Identity</a></li>
            <li><a href="#network"><i class="fa-solid fa-network-wired"></i> Network</a></li>
            <li><a href="#privacy"><i class="fa-solid fa-shield-halved"></i> Privacy</a></li>
            <li><a href="#downloads"><i class="fa-solid fa-download"></i> Downloads</a></li>
            <li><a href="#ai"><i class="fa-solid fa-robot"></i> AI Assistant</a></li>
            <li><a href="#hotkeys"><i class="fa-solid fa-keyboard"></i> Hotkeys</a></li>
            <li><a href="#backup"><i class="fa-solid fa-floppy-disk"></i> Backup & Restore</a></li>
          </ul>
        </nav>
        <main id="settings-main">
          <div id="settings-content">
            <section id="appearance" class="settings-section" data-keywords="appearance font theme color">
              <h1>Appearance</h1>
              <div class="setting-item" data-keywords="font default page text">
                <label for="font-select-btn">Default Page Font</label>
                <div class="setting-control">
                  <button id="font-select-btn">
                    <span id="font-select-value">Browser Default</span>
                    <i class="fa-solid fa-chevron-down"></i>
                  </button>
                </div>
              </div>
            </section>
            <section id="search" class="settings-section" style="display: none;" data-keywords="search engine default google duckduckgo bing startpage">
                <h1>Search Engine</h1>
                <div class="setting-item" data-keywords="default search engine address bar new tab">
                  <label for="search-engine-select">Default Search Engine</label>
                  <div class="setting-control">
                      <select id="search-engine-select"></select>
                  </div>
                </div>
            </section>
             <section id="identity" class="settings-section" style="display: none;" data-keywords="identity privacy user agent browser fingerprinting chrome firefox edge safari">
              <h1>Identity</h1>
              <div class="setting-item" data-keywords="user agent string browser chrome firefox safari edge">
                <div class="setting-label">
                    <h2>User Agent</h2>
                    <p>Choose which browser Bat Browser should identify as. Changes apply to existing tabs upon reload. For sites with persistent logins (like Google), you may need to clear the tab's cache manually for the change to take full effect. Right-click a tab and select 'Clear Cache and Reload'.</p>
                </div>
                <div class="setting-control">
                    <select id="user-agent-select"></select>
                </div>
              </div>
              <div id="custom-user-agent-wrapper" class="setting-item column hidden" data-keywords="custom user agent string">
                   <div class="setting-label">
                      <h2>Custom User Agent</h2>
                      <p>Enter the full User Agent string you want to use.</p>
                  </div>
                  <div class="setting-control full-width">
                      <textarea id="user-agent-custom-input" rows="3" placeholder="e.g., Mozilla/5.0..."></textarea>
                  </div>
              </div>
              <div class="setting-item" data-keywords="test verify check user agent identity">
                <div class="setting-label">
                    <h2>Verify Identity</h2>
                    <p>Open a new tab to a diagnostic site to see what information your browser is currently presenting to websites.</p>
                </div>
                <div class="setting-control">
                    <button id="test-user-agent-btn"><i class="fa-solid fa-vial"></i> Test Current Identity</button>
                </div>
              </div>
            </section>
            <section id="network" class="settings-section" style="display: none;" data-keywords="network proxy http https socks bypass">
                <h1>Network Proxy</h1>
                <div class="setting-item column" data-keywords="proxy connection mode">
                    <div class="setting-label">
                        <h2>Configure Proxy</h2>
                        <p>Choose how Bat Browser connects to the internet. Changes apply to all tabs instantly.</p>
                    </div>
                    <div class="setting-control proxy-mode-selector">
                        <label><input type="radio" name="proxy-mode" value="none"> No Proxy</label>
                        <label><input type="radio" name="proxy-mode" value="autodetect" checked> Auto-detect proxy settings</label>
                        <label><input type="radio" name="proxy-mode" value="manual"> Manual proxy configuration</label>
                    </div>
                </div>
                <div id="proxy-manual-settings" class="hidden">
                    <div class="setting-item column" data-keywords="http proxy server address port">
                        <div class="setting-label">
                            <h2>Proxy Rules</h2>
                            <p>Enter the proxy server address and port. Example: `http=myproxy.com:8080;https=myproxy.com:8080;socks5=127.0.0.1:1080`</p>
                        </div>
                        <div class="setting-control full-width">
                            <input type="text" id="proxy-rules-input" placeholder="scheme=host:port;...">
                        </div>
                    </div>
                    <div class="setting-item column" data-keywords="proxy bypass list hosts domains">
                        <div class="setting-label">
                            <h2>Bypass List</h2>
                            <p>Enter a comma-separated list of hosts that should not use the proxy. Use `&lt;local&gt;` to bypass local addresses.</p>
                        </div>
                        <div class="setting-control full-width">
                            <textarea id="proxy-bypass-input" rows="3" placeholder="<local>,*.google.com,192.168.1.0/24"></textarea>
                        </div>
                    </div>
                </div>
            </section>
            <section id="privacy" class="settings-section" style="display: none;" data-keywords="privacy history data clear cache">
              <h1>Privacy and Security</h1>
              <div class="setting-item" data-keywords="history limit size storage">
                <div class="setting-label">
                    <h2>History Limit</h2>
                    <p>The maximum number of history entries to keep for each tab.</p>
                </div>
                <div class="setting-control">
                    <input type="number" id="history-limit-input" min="10" max="1000" step="10">
                </div>
              </div>
              <div class="setting-item" data-keywords="clear browsing data history all tabs">
                <div class="setting-label">
                    <h2>Clear All History</h2>
                    <p>Permanently delete the browsing history from all tabs.</p>
                </div>
                <div class="setting-control">
                    <button id="clear-all-history-btn" class="danger-button"><i class="fa-solid fa-trash"></i> Clear History</button>
                </div>
              </div>
            </section>
             <section id="downloads" class="settings-section" style="display: none;" data-keywords="downloads files save location folder multi-connection speed">
                <h1>Downloads</h1>
                <div class="setting-item" data-keywords="download location folder directory">
                    <div class="setting-label">
                        <h2>Save Location</h2>
                        <p>Choose the default folder where downloaded files will be saved.</p>
                    </div>
                    <div class="setting-control">
                        <div class="directory-picker">
                            <span id="download-location-display"></span>
                            <button id="select-download-dir-btn">Change...</button>
                        </div>
                    </div>
                </div>
                <div class="setting-item" data-keywords="ask save location file prompt">
                    <div class="setting-label">
                        <h2>Ask Before Saving</h2>
                        <p>Always ask where to save a file before starting the download.</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="ask-before-saving-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item" data-keywords="multi connection parallel speed performance">
                    <div class="setting-label">
                        <h2>Multi-Connection Downloads</h2>
                        <p>Download files in parallel chunks to potentially increase speed. May not be supported by all servers.</p>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" id="multi-connection-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div id="download-connections-wrapper" class="setting-item" data-keywords="connections number parallel threads">
                    <div class="setting-label">
                        <h2>Number of Connections</h2>
                        <p>How many parallel connections to use for each multi-connection download (2-8).</p>
                    </div>
                    <div class="setting-control">
                        <input type="number" id="download-connections-input" min="2" max="8" step="1">
                    </div>
                </div>
            </section>
            <section id="ai" class="settings-section" style="display: none;" data-keywords="ai artificial intelligence gemini api key assistant">
              <h1>AI Assistant</h1>
               <div class="setting-item" data-keywords="get api key gemini google ai studio">
                  <div class="setting-label">
                      <h2>Get your Gemini API Key</h2>
                      <p>You can create and manage your free API keys from Google AI Studio.</p>
                  </div>
                  <div class="setting-control">
                      <button id="get-api-key-btn" class="cta-button"><i class="fa-solid fa-key"></i> Get API Key</button>
                  </div>
              </div>
              <div class="setting-item" data-keywords="enable disable ai assistant gemini">
                  <div class="setting-label">
                      <h2>Enable AI Assistant</h2>
                      <p>Allow Bat AI to assist you with tasks like summarizing pages and analyzing content.</p>
                  </div>
                  <div class="setting-control">
                      <label class="switch">
                          <input type="checkbox" id="ai-enable-toggle">
                          <span class="slider"></span>
                      </label>
                  </div>
              </div>
              <div id="ai-settings-content" class="hidden">
                  <div class="setting-item column" data-keywords="api key management gemini">
                      <div class="setting-label">
                          <h2>Manage Gemini API Keys</h2>
                          <p>Add your Google Gemini API keys below. One key must be active to use the AI Assistant.</p>
                      </div>
                      <div class="setting-control full-width">
                          <div id="api-key-list"></div>
                      </div>
                  </div>
                  <div class="setting-item column" data-keywords="add new api key gemini">
                       <div class="setting-label">
                          <h2>Add New API Key</h2>
                      </div>
                      <div class="setting-control full-width">
                          <div class="add-key-form">
                              <input type="text" id="api-key-name-input" placeholder="Key Name (e.g., 'Personal Key')">
                              <input type="password" id="api-key-input" placeholder="Paste your Gemini API Key here">
                              <button id="add-api-key-btn"><i class="fa-solid fa-plus"></i> Add Key</button>
                          </div>
                      </div>
                  </div>
              </div>
            </section>
            <section id="hotkeys" class="settings-section" style="display: none;" data-keywords="hotkeys shortcuts keyboard bindings keymap">
              <h1>Hotkeys</h1>
              <div id="hotkey-list">
                <!-- Hotkey items will be dynamically inserted here -->
              </div>
            </section>
            <section id="backup" class="settings-section" style="display: none;" data-keywords="backup restore save export import session tabs groups">
              <h1>Backup & Restore</h1>
              <div class="setting-item" data-keywords="export save backup session tabs groups to file">
                <div class="setting-label">
                  <h2>Backup Session</h2>
                  <p>Save all your current tabs, groups, and their history to a single file. You can use this file to restore your session on this or another computer.</p>
                </div>
                <div class="setting-control">
                  <button id="backup-session-btn" class="cta-button"><i class="fa-solid fa-download"></i> Create Backup</button>
                </div>
              </div>
              <div class="setting-item" data-keywords="import restore load session tabs groups from file">
                <div class="setting-label">
                  <h2>Restore Session</h2>
                  <p>Load a session from a backup file. This will replace your current session and restart the browser. Make sure you've saved any work.</p>
                </div>
                <div class="setting-control">
                  <button id="restore-session-btn" class="danger-button"><i class="fa-solid fa-upload"></i> Restore from Backup</button>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>
  </div>

  <div id="all-tabs-view" class="hidden">
    <div class="all-tabs-titlebar">
      <div class="all-tabs-titlebar-left">
        <button id="back-to-browser-btn" title="Back to Browser">
          <i class="fa-solid fa-arrow-left"></i>
          <span>Back to Browser</span>
        </button>
        <div class="search-wrapper">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input type="text" id="all-tabs-search-input" placeholder="Search tabs">
        </div>
      </div>
       <div class="window-controls">
        <button id="all-tabs-min-btn" title="Minimize" aria-label="Minimize"><i class="fa-solid fa-window-minimize"></i></button>
        <button id="all-tabs-max-btn" title="Maximize" aria-label="Maximize"><i id="all-tabs-max-icon" class="fa-regular fa-window-maximize"></i></button>
        <button id="all-tabs-close-btn" title="Close" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
    <div id="all-tabs-list-container"></div>
  </div>

  <div id="downloads-view" class="hidden">
    <div class="all-tabs-titlebar"> <!-- Reuse class for styling -->
      <div class="all-tabs-titlebar-left">
        <button id="downloads-back-to-browser-btn" title="Back to Browser">
          <i class="fa-solid fa-arrow-left"></i>
          <span>Back to Browser</span>
        </button>
        <h2>Downloads</h2>
        <button id="downloads-clear-all-btn">Clear All</button>
      </div>
      <div class="window-controls">
        <button id="downloads-min-btn" title="Minimize" aria-label="Minimize"><i class="fa-solid fa-window-minimize"></i></button>
        <button id="downloads-max-btn" title="Maximize" aria-label="Maximize"><i id="downloads-max-icon" class="fa-regular fa-window-maximize"></i></button>
        <button id="downloads-close-btn" title="Close" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
    <div id="downloads-list-container">
        <!-- Download items will be rendered here -->
    </div>
  </div>

  <div id="font-picker-modal" class="hidden">
    <div class="font-picker-dialog">
        <div class="font-picker-header">
            <h2>Select Default Font</h2>
            <button id="font-picker-close-btn" title="Close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="font-search-wrapper">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="font-search-input" placeholder="Search fonts">
            <button id="font-search-clear-btn" class="hidden" title="Clear search"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="font-list-container">
            <ul id="font-list-default">
                <!-- "Browser Default" will be rendered here by JS -->
            </ul>
            <div class="font-list-separator"></div>
            <div id="font-list-scroll-wrapper">
              <div id="font-list-loader">
                  <i class="fa-solid fa-spinner fa-spin"></i> Loading system fonts...
              </div>
              <ul id="font-list"></ul>
            </div>
        </div>
    </div>
  </div>

  <div id="history-modal" class="hidden">
    <div class="history-dialog">
        <div class="history-header">
            <h2 id="history-modal-title">URL History</h2>
            <button id="history-modal-close-btn" title="Close"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="history-controls">
            <button id="history-clear-btn" class="danger-button"><i class="fa-solid fa-trash"></i> Clear History for This Tab</button>
        </div>
        <div class="history-list-container">
          <ul id="history-list"></ul>
        </div>
    </div>
  </div>

  <div id="context-menu-container"></div>

  <script src="renderer.js" type="module"></script>
</body>
</html>